# Редакторський гайд для `data/overrides.json`

Цей короткий документ пояснює, як заповнювати файл `data/overrides.json`, щоби текстові підміни працювали стабільно й одразу відображалися в застосунку.

## Структура ключів

```
calendar → glyphId → toneId → gender → block → lang → значення
```

* **calendar** — назва календаря (наприклад, `maya`).
* **glyphId** — ідентифікатор гліфа (рядок, як у словниках).
* **toneId** — номер тону (рядок або число, але в JSON краще записувати рядком).
* **gender** — `male`, `female` або універсальне значення `any` (працює як підстраховка для обох статей).
* **block** — один із дозволених блоків: `title`, `meta`, `intro`, `glyph_core`, `tone_core`, `synergy`, `advice`, `shadow`, `conclusion`.
* **lang** — `ua` або `en`.

## Формати значень

* Для блоків `title`, `meta` та всіх текстових секцій можна використовувати:
  * простий рядок — застосовується одразу для обох мов;
  * або об’єкт із ключами `ua`/`en`, якщо потрібні переклади.
* Для `advice` підтримується масив. Кожен елемент масиву — це або рядок, або об’єкт із перекладами. Порядок зберігається, тож розміщуйте поради у потрібній послідовності.

### Приклад запису

```json
{
  "maya": {
    "kimi": {
      "4": {
        "any": {
          "title": {
            "ua": "Кімі 4 — концентрована трансформація",
            "en": "Kimi 4 — Focused Transformation"
          },
          "meta": {
            "ua": "Стислий опис для прев’ю…",
            "en": "Short preview text…"
          },
          "intro": {
            "ua": "Ваш шлях зараз про…",
            "en": "Your path is about…"
          },
          "advice": [
            {
              "ua": "Фокус на базових звичках.",
              "en": "Focus on core habits."
            },
            "Медитація 5–10 хв щодня"
          ]
        }
      }
    }
  }
}
```

## Правила fallback

* Якщо для потрібної статі (`male`/`female`) немає блоку, система шукає варіант у `gender: any` і застосовує його для обох статей.
* Якщо потрібної мови немає, використовується запасна (`ua → en`, `en → ua`). Якщо не знайдено жодного тексту, блок повернеться до згенерованої версії.

## Валідація і логування

* Під час завантаження файл проходить перевірку структури. Будь-які порожні ключі, неправильні назви блоків або невірні типи значень ігноруються.
* У dev-консолі відображається короткий лог із шляхом проблемного вузла та причиною відхилення. Це допомагає швидко знайти й виправити помилки у JSON.

## Телеметрія використання

* Коли override реально застосовано, лічильник збільшується в агрегованій статистиці.
* У dev-режимі можна викликати у консолі функцію `__auraPrintOverrideStats()` і побачити таблицю всіх спрацьованих override за ключем `calendar.glyph.tone.gender.block`.

## Оновлення та кеш

* Будь-які зміни у `overrides.json` одразу інвалідовують кеш описів, тому нові тексти видно після збереження файлу без додаткових дій.

## Рекомендації зі стилю

1. Якщо текст підходить для всіх, використовуйте `gender: any`, щоб не дублювати дані.
2. Стежте за тоном: заголовок має бути стислим, а `meta` — відповідати ліміту прев’ю (система підрізає його автоматично, але краще тримати до ~160 символів).
3. Уникайте зайвих лапок і спецсимволів, щоби не ламати розмітку.
4. Для масиву `advice` додавайте щонайменше 2–3 пункти — вони підставляються у вигляді списку.

## Швидкий чек-лист перед збереженням

- [ ] Усі ключі непорожні, без пробілів на початку чи в кінці.
- [ ] `gender` лише з набору `male` / `female` / `any`.
- [ ] Блоки відповідають дозволеному переліку.
- [ ] Для перекладів використовуються тільки `ua` та `en`.
- [ ] Масиви `advice` містять рядки або перекладені об’єкти.
- [ ] Після оновлення перевірено консоль (логи вкажуть на можливі помилки).

## Погляд уперед

Якщо в майбутньому знадобляться складніші умови (наприклад, за датами або подіями), можна додати окремий файл `data/overrides_rules.json` із правилами формату `when/apply`. Поточна ієрархія залишиться першим шаром для швидких підмін, а новий файл розширить можливості без ламання наявних даних.

